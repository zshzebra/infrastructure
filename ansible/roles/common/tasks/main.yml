---
- name: Update package cache (RHEL/Rocky)
  ansible.builtin.dnf:
    update_cache: true
  when: ansible_facts['os_family'] == "RedHat"

- name: Install EPEL repository (RHEL/Rocky)
  ansible.builtin.dnf:
    name: epel-release
    state: present
  when: ansible_facts['os_family'] == "RedHat"

- name: Install base packages (RHEL/Rocky)
  ansible.builtin.dnf:
    name:
      - python3
      - python3-pip
      - git
      - curl
      - wget
      - tar
      - gzip
      - bzip2
      - rsync
      - htop
      - vim
    state: present
  when: ansible_facts['os_family'] == "RedHat"

- name: Update package cache (Debian/Ubuntu)
  ansible.builtin.apt:
    update_cache: true
  when: ansible_facts['os_family'] == "Debian"

- name: Install base packages (Debian/Ubuntu)
  ansible.builtin.apt:
    name:
      - python3
      - python3-pip
      - git
      - curl
      - wget
      - tar
      - gzip
      - bzip2
      - rsync
      - htop
      - vim
    state: present
  when: ansible_facts['os_family'] == "Debian"

- name: Create services directory
  ansible.builtin.file:
    path: "{{ services_base_path }}"
    state: directory
    mode: "0755"

- name: Create backup directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "0755"
  loop:
    - "{{ backup_base_path }}"
    - "{{ backup_base_path }}/staging"

- name: Set timezone
  community.general.timezone:
    name: Australia/Sydney
